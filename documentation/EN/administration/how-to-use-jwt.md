##  How to use JWT on LinShare

#### 1) Introduction

The 2.2 LinShare version introduces the JWT (JSON Web Token) authentication functionality. You can now use JWT (With expiration date), or permanent JWT (Without expiration date) to be authenticated.


#### 2) Generate a new token

LinShare allows to generate JWT with a short  life time (5 minute by default).

The LinShare token setup is editable in configuration file `linshare.properties`.

```
# JWT support values
# Default token validity in second : 300  (5 minutes)
jwt.expiration=300
jwt.issuer=LinShare
# Ever token (generated by LinShare or others) won't last more than 5 minutes.
jwt.token.max.lifetime=300
jwt.global.key.private.path=/etc/linshare/id_rsa
jwt.global.key.public.path=/etc/linshare/id_rsa.pub
```

> Note : <br>
* You need to specify correctly the path to private key `id_rsa` and public key `id_rsa.pub`.<br>
* LinShare supports two public keys formats : `SSH` and `PEM`.<br>

Now You can request LinShare services to generate your JWT :

    curl -H 'Accept: application/json' -H 'Content-Type: application/json' .../linshare/webservice/rest/user/v2/authentication/jwt -u "`email`:`password`"

Server respond with the new token.

To authenticate to LinShare using your token, you can use this CURL :

    curl -H 'Accept: application/json' -H 'Content-Type: application/json' .../linshare/webservice/rest/user/v2/authentication/authorized -H "Authorization: Bearer $token"

#### 3) Store your public key

Admin of Linshare can store new public key with unique __ISSUER__.

This is allows an other application to be authenticated to LinShare by using its own JWT.

You can use this cURL to store your public_key on LinShare :

```
curl -H 'Accept: application/json' -H 'Content-Type: application/json'  http://*****/linshare/webservice/rest/admin/public_keys -u "admin email: admin password"  -d '{
    "domainUuid" : "LinShareRootDomain",
    "issuer" : "issuer",
    "publicKey" : "-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5NqIm6/34kSSifBgRdKG\nYGZCYa3yA+/WYcuKoSJEeR33dT/T8W+uNxLa5WC1V2HUJpGpI7k3vXZEv8Ge2luo\nSKzGjpbP9tJsiSMmpe8EkE0ckH17uBltIU8E6rmdJv1BEZwjYitKahXDNc2Hvz52\nlIcFB/Bs4egy0hw/Zr1dXLca5/jY2MQTExnjTI4iuKmQaNRIYo2sQ/41JuyGD/So\ncxZ7kjIQPwgtju4N0h9NovnpzbUkcoKiFFVVv7HVn3tVSgOPBlMfrTFexvT90W/r\nAtqZlVfMm1DLehpJ3+jkhqscppMEl9R4+d24O6v+xlDUid54HXYss78uWi4wElVu\njwIDAQAB\n-----END PUBLIC KEY-----",
    "format" : "PEM"
}'
```
> important : <br>
The PEM key format, contain some line breaks, so you need to add `\n` on the end of each line, to make this key authentic.

#### 4) Generate a permanent token

LinShare proposes also to create a token without expiration date.

From the admin interface, the new `JWT permanent token` functionality allows a LinShare administrator to :

* Enable or disable this functionality.

* Allow admin of his subDomain to create a new tokens.

* Allow the user to view and delete his tokens.

* Allow the user to create his own authentication token.

You can refer to LinShare Web service API documentation to use it.

See `linshare-core-2.2.0-documentation-ws-api-userv2.tar.bz2` document here  http://download.linshare.org/components/linshare-core/2.2.0-1/

You can use the following cURL to generate and show a permanent token with user role :

* Create a new permanent token :
```
      curl -H 'Accept: application/json' -H 'Content-Type: application/json' http://****/linshare/webservice/rest/user/v2/jwt -u "`email`:`password`"  -d '{"label" : "LinShare permanent token" }'
```

* Show my own permanent token :
```
      curl -H 'Accept: application/json' -H 'Content-Type: application/json' http://****/linshare/webservice/rest/user/v2/jwt/ -u "`email`:`password`"
```
And this is cURL for administrator to generate a token for another user :

* Create a permanent token for a user :
```
     curl -H 'Accept: application/json' -H 'Content-Type: application/json' http://****/linshare/webservice/rest/admin/jwt?actorUuid=`actorUuid` -u "`admins email`:`admin password`"
      -d '{
        "domainUuid": "`domainUuid`",
        "actorUuid": "`actorUuid`",
        "issuer": "`issuer`",
        "label": "LinShare permanent token",
        "description": "description",
        "subject": "actor email"
      }'
```
* Show all permanent token on my domain :
```
      curl -H 'Accept: application/json' -H 'Content-Type: application/json' http://*****/linshare/webservice/rest/admin/jwt?domainUuid=`domainuuid`-u "`admins email`:`admin password`".
```
